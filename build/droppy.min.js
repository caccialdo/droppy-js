/* Droppy v0.5.0 | (c) 2014 by Arnaud Ceccaldi | MIT License */
!function(){function e(e,t,i,n){return n&&(i=i.bind(n)),e.addEventListener(t,i),{detach:e.removeEventListener.bind(e,t,i)}}var t,i=0,n=Array.prototype.indexOf,o=150,r=function(e,n){if(!e)throw new Error("You need to provide a select element to the constructor.");return this.select=e,n=n||{},t||(t=document.createElement("style"),t.innerHTML=".droppy-container{display:inline-block;outline:0}.droppy-container *,.droppy-container :before,.droppy-container :after{box-sizing:border-box}.droppy-container label{display:block;cursor:pointer}.droppy-container>label{box-sizing:content-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.droppy-container>input:not(:checked)~*>.droppy-drop{max-height:0}.droppy-container>div{position:relative}.droppy-container .droppy-drop{position:absolute;overflow:hidden;max-height:9999px}.droppy-container .droppy-drop>input[type=text]{width:calc(90%);border:none;outline:0;margin-left:5px}.droppy-hidden{display:none;visibility:hidden}",document.head.insertBefore(t,document.head.firstElementChild)),this.render(),i++,this.style=document.createElement("style"),document.body.appendChild(this.style),this.label=this.container.querySelector("label"),this.checkbox=this.container.querySelector("input[type=checkbox]"),this.drop=this.container.querySelector(".droppy-drop"),this.search=this.drop.querySelector("input[type=text]"),this.inputs=this.drop.querySelectorAll("input[name^=hovered]"),this.label.style.maxWidth=(n.maxWidth||o)+"px",this.label.style.width=window.getComputedStyle(this.drop).width,this.bind(),this},s=r.prototype;s.render=function(){var e,t,n,o,r,s=this.select.querySelectorAll("option");for(this.container=document.createElement("span"),this.container.className="droppy-container",t=this.select.querySelector("option:checked").innerHTML,e='<input id="droppy-'+i+'" class="droppy-hidden" type="checkbox"/><label for="droppy-'+i+'">'+t+'</label><div><div class="droppy-drop"><input type="text" placeholder="type to filter"/>',n=0;n<s.length;n++)o=s[n].innerHTML,r=s[n].selected?" checked":"",e+='<input type="radio" name="selected-'+i+'" class="droppy-hidden"'+r+'/><input type="radio" name="hovered-'+i+'" class="droppy-hidden" data-value="'+o.toLowerCase()+'"'+r+'/><label for="droppy-'+i+'" data-value="'+o.toLowerCase()+'" title="'+o+'">'+o+"</label>";e+="</div></div>",this.container.innerHTML=e,this.select.parentNode.insertBefore(this.container,this.select),this.select.classList.add("droppy-hidden")},s.bind=function(){this.handles=[e(this.container,"mousedown",this.onMouseDown,this),e(this.container,"click",this.onClick,this),e(this.container,"keydown",this.onKeyDown,this),e(this.container,"keyup",this.onKeyUp,this),e(this.container,"mouseover",this.onMouseOver,this),e(this.search,"blur",this.onBlur,this)]},s.onMouseDown=function(){this.cancelBlur=this.checkbox.checked},s.onClick=function(e){e.target===this.label?this.onLabelClick(e):this.drop.contains(e.target)&&e.target!==this.drop&&e.target!==this.search&&this.onOptionClick(e)},s.onLabelClick=function(){this.search.focus()},s.onOptionClick=function(e){this.label.innerHTML=e.target.innerHTML,e.target.previousElementSibling.previousElementSibling.checked=!0,this.unFilter()},s.onKeyDown=function(e){27===e.keyCode?(this.checkbox.checked=!1,this.unFilter()):38===e.keyCode?(e.preventDefault(),this.keyNav(-1)):40===e.keyCode?this.keyNav(1):13===e.keyCode&&(this.checkbox.checked=!1,this.onOptionClick({target:this.drop.querySelector("input[name^=hovered]:checked").nextElementSibling}))},s.onKeyUp=function(e){this.filter(e.target.value)},s.onMouseOver=function(e){this.drop.contains(e.target)&&e.target!==this.drop&&e.target!==this.search&&(e.target.previousElementSibling.checked=!0)},s.onBlur=function(){this.cancelBlur||(this.checkbox.checked=!1,this.unFilter())},s.keyNav=function(e){var t=this.inputs,i=this.drop.querySelector("input[name^=hovered]:checked"),o=e>0?0:t.length-1,r=e>0?t.length-1:0;n.call(t,i)===r?t[o].checked=!0:t[n.call(t,i)+e].checked=!0},s.filter=function(e){var t="",i=this.drop.querySelector("input[name^=hovered]:checked");e?(t='.droppy-container > div label:not([data-value*="'+e.toLowerCase()+'"]) {display:none;}',this.inputs=this.drop.querySelectorAll('input[name^=hovered][data-value*="'+e.toLowerCase()+'"]'),this.inputs.length?-1===n.call(this.inputs,i)&&(this.inputs[0].checked=!0):this.drop.querySelector("input[name^=selected]:checked").nextElementSibling.checked=!0):this.inputs=this.drop.querySelectorAll("input[name^=hovered]"),this.style.innerHTML=t},s.unFilter=function(){this.filter(""),this.search.value=""},s.destroy=function(){this.handles.forEach(function(e){e.detach()},this),this.container.parentNode.removeChild(this.container),document.body.removeChild(this.style),this.select.classList.remove("droppy-hidden"),this.container=void 0},window.Droppy=r}();