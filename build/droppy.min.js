/* Droppy v0.5.0 | (c) 2014 by Arnaud Ceccaldi | MIT License */
!function(){function e(e,t,i,n){return n&&(i=i.bind(n)),e.addEventListener(t,i),{detach:e.removeEventListener.bind(e,t,i)}}function t(e){var t="Microsoft Internet Explorer"===e.appName&&document.documentMode<9,i=/iP(od|hone)/i.test(e.userAgent),n=/Android/i.test(e.userAgent);return t||i||n}function i(e,t){var i,n=Object.create(e);for(i in t)n[i]=t[i];return n}var n,o=0,r=Array.prototype.indexOf,s=function(e,r){if(!e)throw new Error("You need to provide a select element to the constructor.");if(t(window.navigator))throw new Error("Your browser is not supported.");return this.select=e,r=this.cfg=i({maxWidth:150,theme:"default"},r||{}),n||(n=document.createElement("style"),n.innerHTML=".droppy-container{display:inline-block;outline:0}.droppy-container *,.droppy-container :before,.droppy-container :after{box-sizing:border-box}.droppy-container label{display:block;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.droppy-container>label{box-sizing:content-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.droppy-container>input:not(:checked)~*>.droppy-drop{max-height:0}.droppy-container>div{position:relative}.droppy-container .droppy-drop{position:absolute;overflow:hidden;max-height:9999px}.droppy-container .droppy-drop>input[type=text]{width:calc(90%);border:none;outline:0;margin-left:5px}.droppy-hidden{display:none;visibility:hidden}",document.head.insertBefore(n,document.head.firstElementChild)),this.render(),o++,this.style=document.createElement("style"),document.body.appendChild(this.style),this.label=this.container.querySelector("label"),this.checkbox=this.container.querySelector("input[type=checkbox]"),this.drop=this.container.querySelector(".droppy-drop"),this.search=this.drop.querySelector("input[type=text]"),this.inputs=this.drop.querySelectorAll("input[name^=hovered]"),this.label.style.maxWidth=r.maxWidth+"px",this.label.style.width=window.getComputedStyle(this.drop).width,this.bind(),this},c=s.prototype;c.render=function(){var e,t,i,n,r,s=this.select.querySelectorAll("option");for(this.container=document.createElement("span"),this.container.className="droppy-container "+this.cfg.theme,t=this.select.querySelector("option:checked").innerHTML,e='<input id="droppy-'+o+'" class="droppy-hidden" type="checkbox"/><label for="droppy-'+o+'">'+t+'</label><div><div class="droppy-drop"><input type="text" placeholder="type to filter"/>',i=0;i<s.length;i++)n=s[i].innerHTML,r=s[i].selected?" checked":"",e+='<input type="radio" name="selected-'+o+'" class="droppy-hidden"'+r+'/><input type="radio" name="hovered-'+o+'" class="droppy-hidden" data-value="'+n.toLowerCase()+'"'+r+'/><label for="droppy-'+o+'" data-index="'+i+'" data-value="'+n.toLowerCase()+'" title="'+n+'">'+n+"</label>";e+="</div></div>",this.container.innerHTML=e,this.select.parentNode.insertBefore(this.container,this.select),this.select.classList.add("droppy-hidden")},c.bind=function(){this.handles=[e(this.container,"mousedown",this.onMouseDown,this),e(this.container,"click",this.onClick,this),e(this.container,"keydown",this.onKeyDown,this),e(this.container,"keyup",this.onKeyUp,this),e(this.container,"mouseover",this.onMouseOver,this),e(this.search,"blur",this.onBlur,this)]},c.onMouseDown=function(){this.cancelBlur=this.checkbox.checked},c.onClick=function(e){e.target===this.label?this.onLabelClick(e):this.drop.contains(e.target)&&e.target!==this.drop&&e.target!==this.search&&this.onOptionClick(e)},c.onLabelClick=function(){this.search.focus()},c.onOptionClick=function(e){var t=e.target.getAttribute("data-index");this.select.selectedIndex=parseInt(t,10),this.label.innerHTML=e.target.getAttribute("title"),e.target.previousElementSibling.previousElementSibling.checked=!0,this.unFilter()},c.onKeyDown=function(e){27===e.keyCode?(this.checkbox.checked=!1,this.unFilter()):38===e.keyCode?(e.preventDefault(),this.keyNav(-1)):40===e.keyCode?this.keyNav(1):13===e.keyCode&&(this.checkbox.checked=!1,this.onOptionClick({target:this.drop.querySelector("input[name^=hovered]:checked").nextElementSibling}))},c.onKeyUp=function(e){this.filter(e.target.value)},c.onMouseOver=function(e){this.drop.contains(e.target)&&e.target!==this.drop&&e.target!==this.search&&(e.target.previousElementSibling.checked=!0)},c.onBlur=function(){this.cancelBlur||(this.checkbox.checked=!1,this.unFilter())},c.keyNav=function(e){var t=this.inputs,i=this.drop.querySelector("input[name^=hovered]:checked"),n=e>0?0:t.length-1,o=e>0?t.length-1:0;r.call(t,i)===o?t[n].checked=!0:t[r.call(t,i)+e].checked=!0},c.filter=function(e){var t="",i=this.drop.querySelector("input[name^=hovered]:checked");e?(t='.droppy-container > div label:not([data-value*="'+e.toLowerCase()+'"]) {display:none;}',this.inputs=this.drop.querySelectorAll('input[name^=hovered][data-value*="'+e.toLowerCase()+'"]'),this.inputs.length?-1===r.call(this.inputs,i)&&(this.inputs[0].checked=!0):this.drop.querySelector("input[name^=selected]:checked").nextElementSibling.checked=!0):this.inputs=this.drop.querySelectorAll("input[name^=hovered]"),this.style.innerHTML=t},c.unFilter=function(){this.filter(""),this.search.value=""},c.destroy=function(){this.handles.forEach(function(e){e.detach()},this),this.container.parentNode.removeChild(this.container),document.body.removeChild(this.style),this.select.classList.remove("droppy-hidden"),this.container=void 0},window.Droppy=s}();